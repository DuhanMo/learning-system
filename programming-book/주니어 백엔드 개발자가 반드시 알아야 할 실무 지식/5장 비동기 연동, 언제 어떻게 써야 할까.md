# 5장 비동기 연동, 언제 어떻게 써야 할까

## 핵심 요약
- 다음 작업을 진행하기 위해 반드시 외부 연동 결과가 필요한게 아니라면 비동기 방식을 고민해보자
- 비동기 연동의 쉬운 방법은 별도 스레드로 실행하는것이고 이 때에는 예외처리에 주의해야 한다
- 서로 다른 시스템 간 비동기로 연동할 땐 주로 메시징 시스템을 이용한다
- 메시지 데이터가 유실되지 않도록 DB에 저장하는 방식인 트랜잭셔널 아웃박스 패턴을 사용할 수 있다
- 배치를 처리해서 비동기 처리할 수 있다(결제 승인 데이터를 모아서 다음 날 전송 등)
- 데이터 변경 시 그 내용을 통지하는 DBMS가 있는데, CDC는 이 기능을 활용해 구현한다

## 주요 개념
- `@Async`, 스레드, 메모리
- 메시징, 카프카, 래빗MQ, 레디스 pub/sub, 이벤트, 커맨드, 궁극적 일관성
- 트랜잭셔널 아웃박스 패턴
- 배치 전송
- CDC(Change Data Capture)

## 메모
- 메시징 시스템은 두 시스템이 서로 영향을 주지 않고, 확장이 용이하다
- 기술을 선택할 때는 개인의 호기심보다 취향보다는 조직의 역량과 지속 가능성을 고려해야 한다
- 메시지 생성 측 고려 사항: 메시지 유실을 고려해야 함
  - 타임아웃 시
    1. 무시한다
    2. 재시도한다
    3. 실패 로그를 남긴다
- 메시지 소비 측 고려 사항: 중복 처리를 고려
- CDC 처리기가 데이터를 통지하는 형태
  1. 변경 데이터를 그대로 대상 시스템에 전파
  2. 변경 데이터를 가공/변환해서 대상 시스템에 전파
- 특정 시스템의 코드를 수정하지 않고 CDC를 사용해 타 시스템에 관련 데이터를 전파할 수 있다
